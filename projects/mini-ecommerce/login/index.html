<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini E-commerce | Acceso</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --text: #0f172a;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --surface: #f8fafc;
      --primary: #111827; /* bot√≥n negro elegante */
      --ring: rgba(59,130,246,0.35);
    }
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      /* Fondo aurora din√°mico */
      background:
        radial-gradient(60vw 60vh at 10% 20%, rgba(99,102,241,.35), transparent 55%),
        radial-gradient(50vw 50vh at 90% 10%, rgba(34,197,94,.25), transparent 60%),
        radial-gradient(55vw 55vh at 10% 90%, rgba(2,132,199,.30), transparent 60%),
        radial-gradient(45vw 45vh at 75% 80%, rgba(244,114,182,.28), transparent 60%),
        linear-gradient(135deg,#0b1220,#1f2937 65%,#0b1220);
      background-size: 120% 120%;
      animation: bg-move 18s ease-in-out infinite;
      background-attachment: fixed;
    }
    @keyframes bg-move {
      0% { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%, 50% 50%; }
      50% { background-position: 40% 20%, 60% 0%, 20% 80%, 80% 60%, 50% 50%; }
      100% { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%, 50% 50%; }
    }
    body::before{ /* textura muy sutil */
      content:''; position:fixed; inset:0; pointer-events:none;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><defs><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="1" stitchTiles="stitch"/></filter></defs><rect width="120" height="120" filter="url(%23n)" opacity="0.02"/></svg>');
      mix-blend-mode: soft-light; opacity:.35;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 32px 20px 48px; }
    .hero { text-align: center; color: white; padding: 32px 0 16px; }
    .hero h1{ font-size: 46px; font-weight: 800; margin: 8px 0; letter-spacing:.3px; }
    .hero p{ font-size: 16px; opacity: .92; }

    .actions{ display:flex; gap:12px; justify-content:center; margin-top:22px; }
    .action-btn{
      padding:12px 18px; border-radius:999px; border:1px solid rgba(255,255,255,.45);
      color:#0f172a; background: linear-gradient(120deg, rgba(255,255,255,.88), rgba(255,255,255,.68)); backdrop-filter:saturate(130%) blur(8px);
      text-decoration:none; font-weight:800; box-shadow: 0 10px 24px rgba(16,24,40,.18);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .action-btn:hover{ transform: translateY(-2px); background:rgba(255,255,255,.95); box-shadow: 0 14px 32px rgba(16,24,40,.26); }

    .grid { display:grid; grid-template-columns: 1fr; gap:24px; align-items:start; max-width: 560px; margin: 0 auto; }
    .card { background: var(--card-bg); border-radius: 18px; box-shadow: 0 18px 40px rgba(16,24,40,.18); overflow: hidden; }
    .card .header{ padding: 18px 22px; border-bottom: 1px solid #eef2f7; background: linear-gradient(180deg,#ffffff,#f7fafc); }
    .card .header h2{ margin:0; font-size:18px; font-weight:700; color:#0f172a; }
    .content{ padding: 22px; }
    .switcher{ display:flex; gap:10px; margin-bottom:14px; }
    .switch-btn{ flex:1; padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; background:#f8fafc; font-weight:700; cursor:pointer; }
    .switch-btn.active{ background:#111827; color:#fff; border-color:#111827; }

    /* Formulario moderno */
    form{ display:flex; flex-direction:column; gap:16px; }
    .field{ position:relative; }
    .field label{ font-size:12px; font-weight:700; color:#334155; display:block; margin-bottom:6px; }
    .input{ width:100%; padding:14px 14px 14px 46px; border:1px solid #e5e7eb; border-radius:14px; background:white; outline:none; transition: box-shadow .2s, border-color .2s, transform .08s; }
    .input:focus{ box-shadow: 0 0 0 3px var(--ring); border-color:#c7d2fe; transform: translateY(-0.5px); }
    .icon{ position:absolute; left:14px; top:38px; width:18px; height:18px; color:#94a3b8; }
    .row{ display:flex; justify-content:space-between; align-items:center; }
    .row .left{ display:flex; gap:8px; align-items:center; }
    .link{ color:#2563eb; text-decoration:none; font-weight:700; }
    .link:hover{ text-decoration:underline; }

    .btn{ padding:14px 16px; border-radius:14px; border:none; color:white; background: var(--primary); font-weight:800; cursor:pointer; box-shadow: 0 10px 24px rgba(17,24,39,.35); transition: transform .1s ease, box-shadow .15s ease; }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 14px 30px rgba(17,24,39,.45); }

    .error{ color:#b91c1c; }
    .success{ color:#166534; }
    .sr{ position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }

    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <div style="font-size:44px">üõçÔ∏è</div>
      <h1>Mini E-commerce</h1>
      <p>Accede primero con tu usuario. Seg√∫n tu rol ver√°s el panel de cliente o el panel de administrador.</p>
      
    </div>

    <div class="grid">
      <!-- Panel de Acceso -->
      <section class="card" aria-labelledby="auth-title">
        <div class="header"><h2 id="auth-title">Iniciar Sesi√≥n</h2></div>
        <div class="content">
          <div class="switcher" role="tablist" aria-label="Modo de acceso">
            <button id="btnLogin" class="switch-btn active" aria-selected="true" aria-controls="login-form">Iniciar sesi√≥n</button>
            <button id="btnRegister" class="switch-btn" aria-selected="false" aria-controls="register-form">Registrarse</button>
          </div>
          <form id="login-form" role="tabpanel" aria-labelledby="btnLogin">
            <div class="field">
              <label for="login-username">Usuario</label>
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm-9 9a9 9 0 1 1 18 0H3Z" fill="currentColor"/></svg>
              <input class="input" id="login-username" name="username" autocomplete="username" required />
            </div>
            <div class="field">
              <label for="login-password">Contrase√±a</label>
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M6 10V8a6 6 0 1 1 12 0v2h1a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h1Zm2 0h8V8a4 4 0 1 0-8 0v2Z" fill="currentColor"/></svg>
              <input class="input" id="login-password" name="password" type="password" autocomplete="current-password" required />
            </div>
            <div class="row">
              <div class="left">
                <input type="checkbox" id="remember" />
                <label for="remember" class="muted" style="font-weight:600">Recordarme</label>
              </div>
              <a id="forgot-link" class="link" href="#">¬øOlvidaste tu contrase√±a?</a>
            </div>
            <button class="btn" type="submit">Entrar</button>
            <p id="login-msg" class="muted" style="margin-top:6px"></p>
          </form>
          <form id="register-form" role="tabpanel" aria-labelledby="btnRegister" style="display:none">
            <div class="field">
              <label for="reg-username">Usuario</label>
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm-9 9a9 9 0 1 1 18 0H3Z" fill="currentColor"/></svg>
              <input class="input" id="reg-username" name="username" autocomplete="username" required />
            </div>
            <div class="field">
              <label for="reg-email">Email</label>
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6Zm2 0 8 5 8-5" stroke="currentColor" stroke-width="2"/></svg>
              <input class="input" id="reg-email" name="email" type="email" autocomplete="email" required />
            </div>
            <div class="field">
              <label for="reg-password">Contrase√±a</label>
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M6 10V8a6 6 0 1 1 12 0v2h1a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h1Zm2 0h8V8a4 4 0 1 0-8 0v2Z" fill="currentColor"/></svg>
              <input class="input" id="reg-password" name="password" type="password" autocomplete="new-password" required />
            </div>
            <div class="row">
              <div class="left" style="gap:10px">
                <label class="muted" style="font-weight:700">Rol:</label>
                <select id="reg-role" class="input" style="padding:10px; max-width:220px">
                  <option value="customer">Cliente</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
            </div>
            <button class="btn" type="submit">Crear cuenta y entrar</button>
            <p id="register-msg" class="muted" style="margin-top:6px"></p>
          </form>
        </div>
      </section>
      <div class="actions">
        <a class="action-btn" href="/">Volver al Portafolio</a>
        <a class="action-btn" href="/projects/mini-ecommerce/">Descripci√≥n del proyecto</a>
      </div>


    </div>
  </div>

  <!-- Modal: Reset Password -->
  <div id="reset-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); align-items:center; justify-content:center; z-index:1000;">
    <div style="width:420px; background:#ffffff; border-radius:16px; box-shadow:0 24px 64px rgba(16,24,40,.35); overflow:hidden;">
      <div style="padding:16px 20px; border-bottom:1px solid #eef2f7; background: linear-gradient(180deg,#ffffff,#f7fafc);">
        <strong style="font-size:16px; color:#0f172a">Recuperar contrase√±a</strong>
      </div>
      <div style="padding:18px 20px; display:flex; flex-direction:column; gap:12px;">
        <label for="reset-email" style="font-size:12px; font-weight:700; color:#334155;">Email de tu cuenta</label>
        <input id="reset-email" class="input" type="email" placeholder="tu@correo.com" />
        <p id="reset-msg" class="muted" style="min-height:20px"></p>
        <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button id="reset-cancel" class="switch-btn" style="max-width:120px">Cancelar</button>
          <button id="reset-submit" class="btn" style="max-width:220px">Generar contrase√±a temporal</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);

    // Prefill del usuario si se eligi√≥ "Recordarme"
    const lastUser = localStorage.getItem('me:lastUser');
    if(lastUser){ const u = document.getElementById('login-username'); if(u) u.value = lastUser; }

    async function api(url, opts){
      const res = await fetch(url, {
        headers: { 'Content-Type': 'application/json' },
        credentials: 'same-origin',
        ...opts
      });
      return res.json();
    }

    // Intento de sesi√≥n existente: si ya est√° logueado, redirigir seg√∫n rol
    (async () => {
      try{
        const me = await api('/api/auth/me');
        if(me && me.success && me.user){
          if(me.user.role === 'admin') window.location.href = '/projects/mini-ecommerce/admin/';
          else window.location.href = '/projects/mini-ecommerce/frontend/';
        }
      }catch(e){ /* ignore */ }
    })();

    // Login
     $('#login-form').addEventListener('submit', async (e) => {
       e.preventDefault();
       $('#login-msg').textContent = '';
       const username = $('#login-username').value.trim();
       const password = $('#login-password').value.trim();
       const remember = document.getElementById('remember')?.checked;
       if(!username || !password){ $('#login-msg').textContent = 'Completa usuario y contrase√±a'; $('#login-msg').className='error'; return; }
       const r = await api('/api/auth/login', { method:'POST', body: JSON.stringify({ username, password })});
       if(r.success){
         if(remember) localStorage.setItem('me:lastUser', username);
         const role = r.user?.role || 'customer';
         $('#login-msg').textContent = 'Inicio de sesi√≥n exitoso'; $('#login-msg').className='success';
         setTimeout(() => {
           if(role === 'admin') window.location.href = '/projects/mini-ecommerce/admin/';
           else window.location.href = '/projects/mini-ecommerce/frontend/';
         }, 150);
       } else {
         $('#login-msg').textContent = r.error || 'Error al iniciar sesi√≥n'; $('#login-msg').className='error';
       }
     });

     // Switch login/register
     const btnLogin = document.getElementById('btnLogin');
     const btnRegister = document.getElementById('btnRegister');
     const loginForm = document.getElementById('login-form');
     const registerForm = document.getElementById('register-form');
     btnLogin.addEventListener('click', () => {
       btnLogin.classList.add('active'); btnRegister.classList.remove('active');
       loginForm.style.display = ''; registerForm.style.display = 'none';
       document.getElementById('auth-title').textContent = 'Iniciar Sesi√≥n';
     });
     btnRegister.addEventListener('click', () => {
       btnRegister.classList.add('active'); btnLogin.classList.remove('active');
       registerForm.style.display = ''; loginForm.style.display = 'none';
       document.getElementById('auth-title').textContent = 'Registrarse';
     });

     // Registrar y auto-login
     document.getElementById('register-form').addEventListener('submit', async (e) => {
       e.preventDefault();
       const username = document.getElementById('reg-username').value.trim();
       const email = document.getElementById('reg-email').value.trim();
       const password = document.getElementById('reg-password').value.trim();
       const role = document.getElementById('reg-role').value;
       const msg = document.getElementById('register-msg');
       msg.textContent = '';
       if(!username || !email || !password){ msg.textContent = 'Completa usuario, email y contrase√±a'; msg.className='error'; return; }
       const r = await api('/api/auth/register', { method:'POST', body: JSON.stringify({ username, email, password, role })});
       if(r.success){
         // Auto-login y redirecci√≥n seg√∫n rol
         const l = await api('/api/auth/login', { method:'POST', body: JSON.stringify({ username, password })});
         if(l.success){
           const target = role === 'admin' ? '/projects/mini-ecommerce/admin/' : '/projects/mini-ecommerce/frontend/';
           window.location.href = target;
         } else {
           msg.textContent = 'Cuenta creada. Inicia sesi√≥n para continuar.'; msg.className='success';
           btnLogin.click();
         }
       } else {
         msg.textContent = r.error || 'No se pudo crear la cuenta'; msg.className='error';
       }
     });
     // Forgot password flow
     document.getElementById('forgot-link')?.addEventListener('click', (e) => {
       e.preventDefault();
       const m = document.getElementById('reset-modal');
       m.style.display = 'flex';
       document.getElementById('reset-email').focus();
     });
     document.getElementById('reset-cancel')?.addEventListener('click', () => {
       const m = document.getElementById('reset-modal');
       m.style.display = 'none';
       const msg = document.getElementById('reset-msg');
       if(msg){ msg.textContent = ''; msg.className = 'muted'; }
     });
     document.getElementById('reset-submit')?.addEventListener('click', async () => {
       const email = document.getElementById('reset-email').value.trim();
       const msg = document.getElementById('reset-msg');
       msg.textContent = '';
       if(!email){ msg.textContent = 'Ingresa tu email'; msg.className = 'error'; return; }
       const r = await api('/api/auth/reset-password', { method:'POST', body: JSON.stringify({ email }) });
       if(r.success){
         msg.className = 'success';
         const temp = r?.data?.temporary_password || '';
         msg.textContent = temp ? `Contrase√±a temporal: ${temp}` : 'Se gener√≥ una contrase√±a temporal.';
       } else {
         msg.className = 'error';
         msg.textContent = r.error || 'No se pudo generar la contrase√±a.';
       }
     });
   </script>
</body>
</html>